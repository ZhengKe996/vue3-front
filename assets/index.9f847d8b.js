import{g as u,c as N,F as A,G as F,i as C,o as d,a as h,H as L,I as O,q as I,p as P,r as W}from"./index.3b13d566.js";const R=n=>{const e=[];return n.forEach(o=>{e.push(...o.getElementsByTagName("img"))}),e},K=n=>n.map(e=>e.src),q=n=>{const e=[];return n.forEach((o,l)=>{e[l]=new Promise((f,m)=>{const c=new Image;c.src=o,c.onload=()=>{f({img:o,index:l})}})}),Promise.all(e)},S=n=>{const e=Object.values(n);return Math.min(...e)},z=n=>{const e=Object.values(n);return Math.max(...e)},_=n=>{const e=S(n);return Object.keys(n).find(o=>n[o]===e)},G={key:1},U={name:"waterfall"},D=Object.assign(U,{props:{data:{type:Array,required:!0},nodeKey:{type:String},column:{default:2,type:Number},columnSpacing:{default:20,type:Number},rowSpacing:{default:20,type:Number},picturePreReading:{type:Boolean,default:!0}},setup(n){const e=n,o=u(0),l=u({}),f=()=>{l.value={};for(let t=0;t<e.column;t++)l.value[t]=0},m=u(null),c=u(0),p=u(0),b=()=>{const{paddingLeft:t,paddingRight:a}=getComputedStyle(m.value,null);p.value=parseFloat(t),c.value=m.value.offsetWidth-parseFloat(t)-parseFloat(a)},r=u(0),k=N(()=>(e.column-1)*e.columnSpacing),y=()=>{b(),r.value=(c.value-k.value)/e.column};A(()=>{y()});let i=[];const x=()=>{i=[];let t=[...document.getElementsByClassName("m-waterfall-item")];const a=R(t),s=K(a);q(s).then(()=>{t.forEach(g=>{i.push(g.offsetHeight)}),v()})},T=()=>{i=[],[...document.getElementsByClassName("m-waterfall-item")].forEach(a=>{i.push(a.offsetHeight)}),v()},v=()=>{e.data.forEach((t,a)=>{t._style||(t._style={},t._style.left=j(),t._style.top=B(),M(a))}),o.value=z(l.value)};F(()=>{e.data.forEach(t=>{delete t._style})});const j=()=>_(l.value)*(r.value+e.columnSpacing)+p.value,B=()=>S(l.value),M=t=>{const a=_(l.value);l.value[a]+=i[t]+e.rowSpacing};C(()=>e.data,t=>{P(()=>{t.every(s=>!s._style)&&f(),e.picturePreReading?x():T()})},{deep:!0,immediate:!0});const E=()=>{setTimeout(()=>{y(),e.data.forEach(t=>{t._style=null})},200)};return C(()=>e.column,()=>{e.picturePreReading&&(r.value=0),E()}),(t,a)=>(d(),h("div",{class:"relative",ref_key:"containerTarget",ref:m,style:I({height:o.value+"px"})},[r.value&&n.data.length?(d(!0),h(L,{key:0},O(n.data,(s,g)=>{var H,w;return d(),h("div",{key:n.nodeKey?s[n.nodeKey]:g,class:"m-waterfall-item absolute duration-300",style:I({width:r.value+"px",left:((H=s._style)==null?void 0:H.left)+"px",top:((w=s._style)==null?void 0:w.top)+"px"})},[W(t.$slots,"default",{item:s,width:r.value,index:g})],4)}),128)):(d(),h("div",G,"\u52A0\u8F7D\u4E2D..."))],4))}});export{D as default};
